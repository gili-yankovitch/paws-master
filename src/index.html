<!DOCTYPE html>
<html>

<head lang="en">
   <meta charset="UTF-8">
   <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
</head>

<body>
   <svg id="canvas" style="width: 100%; height: 1000px; padding: 0px; margin: 0px;">
   </svg>
   <input type="button" id="configureBtn" value="Configure Key..."
      style="display: block; margin: auto; padding: 10px 50px 10px 50px; border-radius: 5px; border-color:darkgray" />
   <script>
      btnSize = 100;
      btnInnerSize = 80;

      var defaultOuterColor = "#d0d0d0";

      c = document.getElementById("canvas");

      function drawButton(c, x, y, caption, idx, f) {
         r = document.createElementNS("http://www.w3.org/2000/svg", "rect");
         r.setAttribute("x", x);
         r.setAttribute("y", y);
         r.setAttribute("width", btnSize);
         r.setAttribute("height", btnSize);
         r.setAttribute("rx", 20);
         r.setAttribute("ry", 20);
         r.setAttribute("style", "fill: #d0d0d0;");
         r.setAttribute("id", "btnOuter" + idx);
         r.setAttribute("btnIdx", idx);
         c.appendChild(r);

         r.onclick = (event) => {
            f(event);
         }

         r = document.createElementNS("http://www.w3.org/2000/svg", "rect");
         r.setAttribute("x", x + btnSize / 2 - btnInnerSize / 2);
         r.setAttribute("y", y + btnSize * 5 / 100);
         r.setAttribute("width", btnInnerSize);
         r.setAttribute("height", btnInnerSize);
         r.setAttribute("rx", 20);
         r.setAttribute("ry", 20);
         r.setAttribute("style", "fill: #ffffff;");
         r.setAttribute("id", "btnInner" + idx);
         r.setAttribute("btnIdx", idx);

         r.onclick = (event) => {
            f(event);
         }

         c.appendChild(r);

         t = document.createElementNS("http://www.w3.org/2000/svg", "text");
         t.innerHTML = caption;
         c.appendChild(t);
         t.setAttribute("x", x + btnSize / 2 - t.getBBox().width / 2);
         t.setAttribute("y", y + btnSize / 2 - t.getBBox().height / 2);
         t.setAttribute("id", "caption" + idx);
         t.setAttribute("btnIdx", idx);
         t.setAttribute("style", "font-family: Arial");

         t.onclick = (event) => {
            event.
               f(event);
         }
      }

      $(window).on('load', () => {
         // Get number of buttons
         jQuery.get(
            "/api/btnNum",
            (data) => {
               if (!data["success"]) {
                  alert("Internal Error Occurred...");
               }

               var screenWidth = 600 - 30;

               // Supported layouts: 2x2 3x2 3x3
               var n = data["btnNum"];

               if (n <= 4) {
                  btnsInRow = 2;
               }
               else if (n < 12) {
                  btnsInRow = 3;
               }
               else {
                  btnsInRow = 4;
               }

               var padX = 10;
               var padY = 10;

               var startX = screenWidth / 2 - (btnsInRow * (padX * 2 + btnSize)) / 2;
               var startY = 10;

               // Resize canvas
               c.style.height = startY * 2 + Math.floor(n / btnsInRow) * (padY * 2 + btnSize);
               c.style.width = screenWidth;

               // Draw btnNum number of buttons
               for (var i = 0; i < n; ++i) {
                  // Try to match pysical layout
                  if (Math.floor(i / btnsInRow) % 2 == 0) {
                     xPos = startX + (i % btnsInRow) * (padX * 2 + btnSize);
                  }
                  else {
                     xPos = startX + (btnsInRow - i % btnsInRow - 1) * (padX * 2 + btnSize);
                  }

                  yPos = startY + Math.floor(i / btnsInRow) * (padY * 2 + btnSize);
                  drawButton(c,
                     xPos,
                     yPos
                     , "Hello " + i, i, (event) => {
                        alert("Pressed idx " + event.target.getAttribute("btnIdx"));
                     });
               }
            }
         );
      });
      $("#configureBtn").click((event) => {
         jQuery.get(
            "/api/toggleBtnPrompt",
            (data) => {
               if (!data["success"]) {
                  alert("Internal Error Occurred...");

                  return;
               }

               // Highlight key
               $("#btnOuter" + data["pressedIdx"])[0].style.fill = "#000000";
            }
         );
      })
   </script>
</body>

</html>